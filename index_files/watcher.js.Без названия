document.querySelectorAll||(document.querySelectorAll=function(a){var b,c=document.createElement("style"),d=[];for(document.documentElement.firstChild.appendChild(c),document._qsa=[],c.styleSheet.cssText=a+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),c.parentNode.removeChild(c);document._qsa.length;)b=document._qsa.shift(),b.style.removeAttribute("x-qsa"),d.push(b);return document._qsa=null,d}),document.querySelector||(document.querySelector=function(a){var b=document.querySelectorAll(a);return b.length?b[0]:null}),function(w,d){function runCallbacks(){callbacks=w.rts_callbacks||[];for(var a in callbacks){var b=callbacks[a];"function"==typeof b&&b.apply(this)}}var debugMode="off",Utils={};Utils.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a["super"]=b.prototype},Utils.proxy=function(a,b){return function(){return a.apply(b,arguments)}},Utils.sleep=function(a){for(var b=(new Date).getTime(),c=0;1e7>c&&!((new Date).getTime()-b>a);c++);},Utils.log=function(a){var b=new Date,c=b.getTime();"on"===debugMode&&console.log(c+" "+a)},Utils.Query={get:function(a){var b=this.getAll();return b[a]},getAll:function(){var a,b={},c=window.location.href.indexOf("?");if(-1==c)return b;for(var d=window.location.href.slice(c+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),b[decodeURIComponent(a[0])]=decodeURIComponent(a[1]);return b}},Utils.Cookie={get:function(a){for(var b=a?void 0:{},c=document.cookie?document.cookie.split("; "):[],d=0,e=c.length;e>d;d++){var f=c[d].split("="),g=this.decode(f.shift()),h=f.join("=");if(a&&a===g){b=this.read(h);break}a||void 0===(h=this.read(h))||(b[g]=h)}return b},set:function(a,b,c){if(c=c||{},c.expires=c.expires||1,c.path=c.path||"/",c.domain=c.domain||"",c.secure=c.secure||"","number"==typeof c.expires){var d=c.expires,e=c.expires=new Date;e.setTime(+e+864e5*d)}return document.cookie=[this.encode(a),"=",this.stringifyValue(b),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")},remove:function(){},read:function(a,b){var c=this.parseValue(a);return"function"==typeof b?b(c):c},encode:function(a){return encodeURIComponent(a)},decode:function(a){return decodeURIComponent(a)},stringifyValue:function(a){return this.encode(String(a))},parseValue:function(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(/\+/g," "))}catch(b){}}},Utils.Event={addListener:function(a,b,c){if(d.addEventListener)a.addEventListener(b,c,!1);else{if(!d.attachEvent)throw new Error("Cannot attach event");a.attachEvent("on"+b,c)}},trigger:function(a,b){if(d.dispatchEvent){var c=d.createEvent("Event");c.initEvent(b,!0,!0),d.dispatchEvent(c)}}},Utils.Random={generate:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;++d)b+=c.charAt(Math.floor(Math.random()*c.length));return b}},Utils.utf8Encode=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},Utils.sha1=function(a){var b,c,d,e,f,g,h,i,j,k=function(a,b){var c=a<<b|a>>>32-b;return c},l=function(a){var b,c,d="";for(b=7;b>=0;b--)c=a>>>4*b&15,d+=c.toString(16);return d},m=new Array(80),n=1732584193,o=4023233417,p=2562383102,q=271733878,r=3285377520;a=this.utf8Encode(a);var s=a.length,t=new Array;for(c=0;s-3>c;c+=4)d=a.charCodeAt(c)<<24|a.charCodeAt(c+1)<<16|a.charCodeAt(c+2)<<8|a.charCodeAt(c+3),t.push(d);switch(s%4){case 0:c=2147483648;break;case 1:c=a.charCodeAt(s-1)<<24|8388608;break;case 2:c=a.charCodeAt(s-2)<<24|a.charCodeAt(s-1)<<16|32768;break;case 3:c=a.charCodeAt(s-3)<<24|a.charCodeAt(s-2)<<16|a.charCodeAt(s-1)<<8|128}for(t.push(c);t.length%16!=14;)t.push(0);for(t.push(s>>>29),t.push(s<<3&4294967295),b=0;b<t.length;b+=16){for(c=0;16>c;c++)m[c]=t[b+c];for(c=16;79>=c;c++)m[c]=k(m[c-3]^m[c-8]^m[c-14]^m[c-16],1);for(e=n,f=o,g=p,h=q,i=r,c=0;19>=c;c++)j=k(e,5)+(f&g|~f&h)+i+m[c]+1518500249&4294967295,i=h,h=g,g=k(f,30),f=e,e=j;for(c=20;39>=c;c++)j=k(e,5)+(f^g^h)+i+m[c]+1859775393&4294967295,i=h,h=g,g=k(f,30),f=e,e=j;for(c=40;59>=c;c++)j=k(e,5)+(f&g|f&h|g&h)+i+m[c]+2400959708&4294967295,i=h,h=g,g=k(f,30),f=e,e=j;for(c=60;79>=c;c++)j=k(e,5)+(f^g^h)+i+m[c]+3395469782&4294967295,i=h,h=g,g=k(f,30),f=e,e=j;n=n+e&4294967295,o=o+f&4294967295,p=p+g&4294967295,q=q+h&4294967295,r=r+i&4294967295}var j=l(n)+l(o)+l(p)+l(q)+l(r);return j.toLowerCase()},Utils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=this._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=this._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}},Utils.Json={encode:function(a){if("undefined"==typeof JSON){var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a+'"'),String(a);var c,d,e=[],f=a&&a.constructor==Array;for(c in a)d=a[c],b=typeof d,"string"==b?d='"'+d+'"':"object"==b&&null!==d&&(d=this.encode(d)),e.push((f?"":'"'+c+'":')+String(d));return(f?"[":"{")+String(e)+(f?"]":"}")}return JSON.stringify(a)},decode:function(str){return"undefined"==typeof JSON?(""===str&&(str='""'),eval("var p="+str+";"),p):JSON.parse(str)}};var Registry=function(){var a;return{read:function(b){a=b},get:function(b,c){return a[b]?a[b]:c}}}(),Router=function(a){return{getProceedUrl:function(b){return a+"/t/proceed?s="+b.getSignature()}}}("http://r.rts.topbeauty-blog.ru"),LoggerException=function(a,b,c){this.level=a,this.code=b,this.message=c};LoggerException.prototype.getLevel=function(){return this.level},LoggerException.prototype.getCode=function(){return this.code},LoggerException.prototype.getMessage=function(){return this.message},LoggerException.prototype.getInfo=function(){return{cookieEnabled:w.navigator.cookieEnabled,userAgent:w.navigator.userAgent}},LoggerException.prototype.getSignature=function(){var a={level:this.getLevel(),code:this.getCode(),message:this.getMessage(),info:this.getInfo()};return Utils.Base64.encode(Utils.Json.encode(a))};var WarningException=function(a,b){WarningException["super"].constructor.call(this,"warning",a,b)};Utils.inherit(WarningException,LoggerException);var ErrorException=function(a,b){WarningException["super"].constructor.call(this,"error",a,b)};Utils.inherit(ErrorException,LoggerException);var Logger=function(){return{log:function(a){ApiAgent.log(a)}}},ApiDriver=function(a){this.queue=[],this.waiting=!1,this.host=a,this.inProcess=!1};ApiDriver.prototype.callMethod=function(a,b,c,d){var e=this.buildUrl(a);b=this.prepareData(b);var f=Utils.proxy(function(){"function"==typeof c&&c.apply(),this.checkQueue()},this),g=Utils.proxy(function(){"function"==typeof d&&d.apply(),this.checkQueue()},this);this.waiting===!0?this.queue.push({url:e,data:b,success:f,fail:g}):this.sendRequest(e,b,f,g)},ApiDriver.prototype.sendRequest=function(){throw new Error("Send request function must define in a child class")},ApiDriver.prototype.buildUrl=function(){throw new Error("Build url function must define in a child class")},ApiDriver.prototype.checkQueue=function(){(task=this.queue.shift())?this.sendRequest(task.url,task.data,task.success,task.fail):this.waiting=!1},ApiDriver.prototype.prepareData=function(a){return"object"!=typeof a&&(a={data:a}),a.timestamp=Math.floor((new Date).getTime()/1e3),a},ApiDriver.prototype.convertToJson=function(a){return Utils.Json.encode(a)},ApiDriver.prototype.getHost=function(){return this.host};var XHRDriver=function(a){XHRDriver["super"].constructor.call(this,a)};Utils.inherit(XHRDriver,ApiDriver),XHRDriver.prototype.buildUrl=function(a){return this.getHost()+"/"+a},XHRDriver.prototype.sendRequest=function(a,b,c,d){b=this.stringify(b);try{var e=w.XMLHttpRequest?new w.XMLHttpRequest:new ActiveXObject("Msxml2.XMLHTTP");e.open("POST",a),e.withCredentials=!0,e.setRequestHeader("Accept","image/gif"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.waiting=!0,e.onreadystatechange=Utils.proxy(function(){4==e.readyState&&(200==e.status?"function"==typeof c&&c.apply():"function"==typeof d&&d.apply())},this),e.send(b||null)}catch(f){throw f}},XHRDriver.prototype.stringify=function(a){var b=[];for(var c in a){var d=a[c];"object"==typeof d&&(d=this.stringify(d)),b.push(c+"="+encodeURIComponent(d))}return b.join("&")};var PixelDriver=function(a){PixelDriver["super"].constructor.call(this,a)};Utils.inherit(PixelDriver,ApiDriver),PixelDriver.prototype.buildUrl=function(a){return this.getHost()+"/"+a+".gif"},PixelDriver.prototype.sendRequest=function(a,b,c){var e=d.createElement("img");this.waiting=!0,e.onload=function(){"function"==typeof c&&c.apply()},e.width="1",e.height="1",e.src=a+"?s="+b.s+"&t="+(new Date).getTime(),d.getElementsByTagName("body")[0].appendChild(e)};var ApiAgent=function(a){var b;return b="withCredentials"in new XMLHttpRequest?new XHRDriver(a):new PixelDriver(a),{makeShow:function(a,c){Utils.log("Make show "+a.getId());var d={s:a.getSignature()};b.callMethod("show",d,c)},reachGoal:function(a,c){Utils.log("Reach goal for show "+a.getShow().getId());var d=a.getShow(),e={s:d.getSignature()};b.callMethod("goal",e,c)},checkIn:function(a,c){Utils.log("Check In");var d={s:a.getSignature()};b.callMethod("checkin",d,c)},log:function(a,c){Utils.log("Logging");var d={s:a.getSignature()};b.callMethod("log",d,c)}}}("http://api.rts.topbeauty-blog.ru/v2"),Timekeeper=function(a){this.Show=a,this.interval=Registry.get("checkInInterval",3e4),this.inCheckInProcess=!1,this.startSmartyChecking(),this.startIntervalChecking(),this.checkIn()};Timekeeper.prototype.getShow=function(){return this.Show},Timekeeper.prototype.checkIn=function(){this.inCheckInProcess||(this.inCheckInProcess=!0,ApiAgent.checkIn(this.getShow(),Utils.proxy(function(){this.inCheckInProcess=!1},this)))},Timekeeper.prototype.startIntervalChecking=function(){w.setInterval(Utils.proxy(this.checkIn,this),this.interval)},Timekeeper.prototype.startSmartyChecking=function(){w.onmouseout=Utils.proxy(function(a){a=a||event;var b=a.relatedTarget||a.toElement;null===b&&this.checkIn()},this)};var TargetId=function(a){var b=a;return{getValue:function(){return b}}},Target=function(a){if(!a.getValue())throw new Error("Target id must be set");this.TargetId=a,this.init()};Target.prototype.getId=function(){return this.TargetId.getValue()},Target.prototype.init=function(){this.buildUserQuery()},Target.prototype.buildUserQuery=function(){var a=Utils.Query.getAll(),b=Registry.get("cookieUserQueryParam","user_query"),c=Utils.Cookie.get(b);c&&(c=Utils.Json.decode(c));var d={};for(var e in c)d[e]=c[e];for(var f in a)d[f]=a[f];this.userData=d},Target.prototype.getUserData=function(){return this.userData};var TupleId=function(a){var b=a;return{getValue:function(){return b}}},Tuple=function(a){this.TupleId=a};Tuple.prototype.getId=function(){return this.TupleId.getValue()};var ShowId=function(a){var b=a;return b||(b=this.generateValue()),{getValue:function(){return b}}};ShowId.prototype.generateValue=function(){return Utils.sha1(Utils.Random.generate(128)+(new Date).getTime())+Utils.sha1(Utils.Random.generate(128)+(new Date).getTime())};var Show=function(a,b,c){this.id=a,this.Target=b,this.Tuple=c,ApiAgent.makeShow(this,function(){Utils.log("Show made")})};Show.prototype.getId=function(){return this.id.getValue()},Show.prototype.getTarget=function(){return this.Target},Show.prototype.getTuple=function(){return this.Tuple},Show.prototype.getSignature=function(){var a={show:this.getId(),target:this.getTarget().getId(),tuple:this.getTuple().getId(),userData:this.getTarget().getUserData()};return Utils.Base64.encode(Utils.Json.encode(a))};var Goal=function(a){this.Show=a};Goal.prototype.getShow=function(){return this.Show};var Metrika=function(a){Registry.read(a),this.Logger=new Logger;try{if(w.navigator.cookieEnabled===!1)throw new WarningException(2,"Cookies are disabled");if(this.Target=this.buildTarget(),this.Tuple=this.buildTuple(),!this.Tuple.getId())return;this.Show=new Show(new ShowId,this.Target,this.Tuple),this.Timekeeper=new Timekeeper(this.Show),this.initLinks(),Utils.Event.trigger(this,"rts:metrika_loaded"),this.runAfterLoad()}catch(b){if(Utils.log(b.message),b instanceof LoggerException)this.Logger.log(b);else{var c=b.lineNumber+"-"+b.columnNumber+": "+b.message+" ("+b.toString()+")",d=new ErrorException(0,c);this.Logger.log(d)}}};Metrika.prototype.buildTarget=function(){var a=Registry.get("targetId",null);if(null===a)throw new WarningException(3,"Target id is not set");return new Target(new TargetId(a))},Metrika.prototype.buildTuple=function(){var a=Registry.get("tupleQueryParam","rts_tid"),b=Registry.get("tupleCookieParam",a),c=Utils.Query.get(a)||Utils.Cookie.get(b);if(null===c)throw new WarningException(4,"Tuple id has not found");return new Tuple(new TupleId(c))},Metrika.prototype.reachGoal=function(a){var b=new Goal(this.Show);ApiAgent.reachGoal(b,a)},Metrika.prototype.handlerClick=function(){this.reachGoal()},Metrika.prototype.initLinks=function(){Utils.log("Begin: Replacing links.");for(var a=Router.getProceedUrl(this.Show),b=d.querySelectorAll("a"),c=0;c<b.length;++c){var e=b[c];"0"!=e.getAttribute("data-rts-replace")&&(e.setAttribute("href",a),Utils.Event.addListener(e,"click",Utils.proxy(this.handlerClick,this)))}Utils.log("End: Replacing links.")},Metrika.prototype.runAfterLoad=function(){var a=w.rts_load_metrika_callbacks||[];for(var b in a){var c=a[b];"function"==typeof c&&c.call(this,this)}},Metrika.prototype.getProceedUrl=function(){return Router.getProceedUrl(this.Show)},w.Rts=w.Rts||{},w.Rts.Metrika=Metrika,function(){Utils.log("Adding event handler"),runCallbacks()}()}(this,this.document);