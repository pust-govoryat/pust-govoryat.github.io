var isPopup = true;
var popipTimeOut = 0;

function popupLoading() {
  $(document).ready(function() {
    if (isPopup) {
      d = new Date();
      p = new Date(d.getTime() - 10 * 86400000);
      var yr = d.getFullYear();
      montha = '01,02,03,04,05,06,07,08,09,10,11,12'.split(',');
      date_html = p.getDate() + '.' + montha[p.getMonth()] + '.' + yr;
      p0 = new Date(d.getTime() - 0 * 86400000);
      date_html0 = p0.getDate() + '.' + montha[p0.getMonth()] + '.' + yr;
      $('.js-date').html(date_html0);
      setTimeout(function() {
        var flag = true;
        $(window).mouseout(function(e) {
          if (e.pageY - $(window).scrollTop() < 1 && flag == true) {
            $('.p5213, .t1296').fadeIn(300);
            $('.t4527').fadeIn(300);
            flag = false;
          }
        })
      }, 2000);
    //   if ($('#p5213_show').lenght > 0) {
    //     var windowHeight = $(window).height();
    //     $(document).on('scroll', function() {
    //       var self = $('#p5213_show');
    //       var height = self.offset().top + self.height();
    //       if ($(document).scrollTop() + windowHeight >= height) {
    //         $('.p5213, .t1296').fadeIn(300);
    //         $('.t4527').fadeIn(300);
    //       }
    //     });
    //   } else {
    //     console.log('Block #p5213_show not founded!');
    //   }
      $('div.r6934').click(function() {
        $('.p5213').css('display', 'none');
        $('.t4527').css('display', 'none');
      })
      $('div[title^="http"]').click(function() {
        window.open(($(this).attr('title'), closeLink));
      });
      $(".r6934").hover(function() {
        var title = $(this).attr(closeLink);
        $(this).attr("tmp_title", title);
        $(this).attr("title", "Закрыть");
      });
      if (parseInt($(".js-timer").attr("data-time"))) {
        widget_timer(parseInt($(".js-timer").attr("data-time")));
      }
    }
    // var a = document.getElementsByTagName('a');
    // for (var i in a) {
    //   a[i].onclick = function() {
    //     if (this.getAttribute('href') != null) {
    //       if (this.getAttribute('href') == '#out') {
    //         $('.p5213').css('display', 'none');
    //         $('.t4527').css('display', 'none');
    //         return false;
    //       }
    //       window.open(this.getAttribute('href'));
    //       setTimeout(function() {
    //         window.location.href = userLink;
    //       }, 4000);
    //       return false;
    //     } else {
    //       window.location.href = userLink;
    //     }
    //   }
    // }
  });
}
var popupLoad = setInterval(popupLoading, 500);

function findGetParameter(parameterName) {
  var result = '',
    tmp = [];
  var items = location.search.substr(1).split("&");
  for (var index = 0; index < items.length; index++) {
    tmp = items[index].split("=");
    if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
  }
  return result;
}

function widget_timer(timer) {
  if (timer <= 0) {
    return false;
  }
  var baseTime = timer * 60 * 1000;
  baseTime = parseInt(new Date().getTime() + baseTime);
  var first_start = 0;
  setInterval(function() {
    var endTime = new Date(baseTime);
    var cur = new Date();
    var diff = endTime - cur;
    var millis = diff % 1000;
    diff = Math.floor(diff / 1000);
    var sec = diff % 60;
    if (sec < 10) sec = "0" + sec;
    diff = Math.floor(diff / 60);
    var min = diff % 60;
    if (min < 10) min = "0" + min;
    diff = Math.floor(diff / 60);
    var hours = diff % 24;
    if (hours < 10) hours = "0" + hours;
    var days = Math.floor(diff / 24);
    if (days < 10) days = "0" + days;
    if (hours < 1 && first_start == 0) {
      $('.js-timer .hour').parent().next().remove();
      $('.js-timer .hour').parent().remove();
    } else {
      $('.js-timer .hour').html(hours);
    }
    $('.js-timer .minute').html(min);
    $('.js-timer .second').html(sec);
    first_start = 1;
  }, 1000);
}